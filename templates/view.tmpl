#*
Copyright (c) 2003-2009  Pavel Rychly

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; version 2
dated June, 1991.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
*#
#from translation import ugettext as _
#from templating.filters import *
#from cmpltmpl.document import document
#extends document

#def title
$_("Concordance")#slurp
#end def

#def headers

#if $righttoleft
<style>
.lc {direction: rtl}
.kw {direction: rtl}
.rc {direction: rtl}
</style>
#end if
#end def

#def bodyonload
require(['${client_model_dir}/${page_model}', 'conf'], function(pageSelf, conf) {
    conf.q = "$q";
    conf.replicableQuery = #if $getVar('replicable_query', False)#true#else#false#end if#;
    conf.concLineMaxGroupNum = $conc_line_max_group_num;
    conf.WideCtxGlobals = #filter $Jsonize#$widectx_globals#end filter#;
    conf.CorporaColumns = #filter $Jsonize#${CorporaColumns}#end filter#;
    conf.KWICCorps = #filter $Jsonize#$KWICCorps#end filter#;
    conf.ViewMode = '${viewmode}';
    conf.ShowLineNumbers = #if $line_numbers#true#else#false#end if#;
    conf.Pagination = #filter $Jsonize#$pagination#end filter#;
    conf.FromPage = #if $fromp#$fromp#else#0#end if#;
    conf.Lines = #filter $Jsonize#$Lines#end filter#;
    conf.SortIdx = #filter $Jsonize#$Sort_idx#end filter#;
    conf.ConcSize = $concsize;
    conf.FullSize = $fullsize;
    conf.SampledSize = $sampled_size;
    conf.ResultIpm = $result_relative_freq;
    conf.ResultArf = #if $result_arf#$result_arf#else#null#end if#;
    conf.ResultShuffled = #filter $Jsonize#$result_shuffled#end filter#;
    conf.NumLinesInGroups = $num_lines_in_groups;
    conf.LinesGroupsNumbers = #filter $Jsonize#$lines_groups_numbers#end filter#;
    conf.ContainsWithin = #filter $Jsonize#$getVar('query_contains_within', False)#end filter#;
    conf.ShowConcToolbar = #filter $Jsonize#$use_conc_toolbar#end filter#;

    #if $running_calc
    conf.numLines = $len($Lines);
    conf.q = '$q';
    conf.q2 = '$q[2]';
    conf.q2toEnd = '$q[2:]';
    conf.globals = '$globals';
    conf.Unfinished = true;
    var model = pageSelf.init(conf);
    model.reloadHits(conf);
    #else
    conf.Unfinished = false;
    var model = pageSelf.init(conf);
    #end if
});
#end def


#def state_navigation
#filter None
$query_overview_bar()
#end filter
#end def

#def concordance
<div id="conc-wrapper">
    <div id="conc-top-bar"><div class="info-level">-</div></div>
   <img class="root-loader" src="${files_path}/img/ajax-loader.gif" title="$_('Loading...')" alt="$_('Loading...')" />
   <div id="conc-bottom-bar">-</div>
</div>
#end def